---
#title: "Milk Cows per Thousand Head Analysis"
output: 
  html_document:
    always_allow_html: true
    toc: true
    toc_float: true
---

```{r setup, include=FALSE, warning=FALSE,message=FALSE}
#code_folding: hide
#load packages
library(tidyverse)
library(ggridges)
library(patchwork)
library(plotly)
library(purrr)
library(broom)
library(readxl)
library(ggplot2)
library(sf)
library(usmap)
library(kableExtra)
library(RColorBrewer)
library(knitr)
library(leaflet)

#R figure settings
knitr::opts_chunk$set(
  fig.width = 9,
  fig.asp = .6,
  out.width = "90%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

knitr::opts_chunk$set(
  echo = FALSE,         #code is not displayed in output
  warning = FALSE,     #warnings false
  message = FALSE      #messages false
)
```


```{r}
#read milk cows data
milk_cows = readxl::read_excel("./data/milkcowsandprod.xlsx", 
                               sheet="Milk cows", 
                               skip=1,
                               col_names = TRUE) |>
  janitor::clean_names() |>
  #drop_na() |>
  rename(region = x1) |>
  rename(state = back_to_content_page) |>
  filter_all(any_vars(!is.na(.))) |>
  rename_with(~ gsub("^x", "", .), starts_with("x")) |>
 mutate(region = case_when(
    state %in% c("Maine", "New Hampshire", "Vermont", "Massachusetts", "Rhode Island", 
                 "Connecticut", "New York", "New Jersey", "Pennsylvania", 
                 "Delaware", "Maryland") ~ "Northeast",
    state %in% c("Michigan","Wisconsin","Minnesota") ~ "Lake States",
    state %in% c("Ohio","Indiana","Illinois","Iowa","Missouri") ~ "Corn Belt",
    state %in% c("North Dakota", "South Dakota", "Nebraska", "Kansas") ~ "Northern Plains",
    state %in% c("Virginia", "West Virginia", "North Carolina", "Kentucky", "Tennessee") ~ "Appalachia",
    state %in% c("South Carolina", "Georgia", "Florida", "Alabama") ~ "Southeast",
    state %in% c("Mississippi", "Arkansas","Louisiana") ~ "Delta States",
    state %in% c("Oklahoma","Texas") ~ "Southern Plains",
    state %in% c("Montana","Idaho","Wyoming","Colorado","New Mexico","Arizona","Utah","Nevada") ~ "Mountain Region",
    state %in% c("Washington","Oregon","California") ~ "West Coast",
    state %in% c("Alaska","Hawaii") ~ "Other States"
    #TRUE ~ "Other"  # Default case for states not in the Northeast
  )) |>
  filter(!is.na(state)) |>
  filter(region != "Other States") |>
  mutate(
    ##remove non numeric character and convert to numeric
    `2019` = gsub("[^0-9,.-]", "", `2019`) |> as.numeric(), 
    `2020` = gsub("[^0-9,.-]", "", `2020`) |> as.numeric(),
    `2021` = gsub("[^0-9,.-]", "", `2021`) |> as.numeric(),
    `2022` = gsub("[^0-9,.-]", "", `2022`) |> as.numeric(),
    `2023` = gsub("[^0-9,.-]", "", `2023`) |> as.numeric()
  ) |>
  pivot_longer(
    cols = 3:56,
    names_to = "year",
    values_to = "number_of_cows"
  )  |>
  drop_na()

```

## Milk Cows Statistics by State
```{r}
top_5_states <- milk_cows |>
  group_by(state) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE)) |>
  arrange(desc(total_cows)) |>
  rename(State = state, 
         "Total Cows" = total_cows) |>
  head(5)  

total_cows_usa <- round(sum(milk_cows$number_of_cows, na.rm = TRUE))
avg_cows_state <- round(mean(top_5_states$`Total Cows`, na.rm = TRUE))
#min_cows_state <- min(top_5_states$`Total Cows`, na.rm = TRUE)

summary_stats <- tibble(
   State = c("Total Cows in USA",  "Avg Number of Cows in USA"), #"Min Number of Cows in USA",
  `Total Cows` = c(total_cows_usa, avg_cows_state) #min_cows_state, 
) 

final_table <- bind_rows(top_5_states, summary_stats) 

#print
knitr::kable(final_table, caption = "Top 5 States and Summary Statistics for Total Cows (per Thousand Head) (1970-2023)", format="html") |>
  kable_styling(full_width = TRUE, bootstrap_options = "bordered")
```

```{r}
#table 1970 by state
milk_cows |>
  filter(year == 1970) |>
  group_by(state,year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE)) |>
  arrange(desc(total_cows)) |>
  rename(State = state, 
         "Total Cows 1970" = total_cows) |>
  head(5)  |>
  knitr::kable(caption = "Top 5 States in Total Cows (per Thousand Head) (1970)", format="html") |>
  kable_styling(full_width = TRUE, bootstrap_options = "bordered")


#line plots 1970 by state
milk_cows_state_1970 = milk_cows |>
  filter(year == 1970) |>
  group_by(state,year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE)) |>
  arrange(desc(total_cows)) |>
  rename(State = state, 
         "Total Cows 1970" = total_cows, 
         Year = year) 


ggplot(milk_cows_state_1970, aes(x = reorder(State, `Total Cows 1970`), y = `Total Cows 1970`, color = State)) +
  geom_point(size=0.8) +  
  geom_line(group = 1, color = "lightblue") + 
  labs(
    title = "Total Number of Cows by State (per Thousand Head) (1970)",
    x = "State",
    y = "Total Cows",
    color = "State"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 80, hjust = 1)) -> static_line_state_1970

ggplotly(static_line_state_1970)

#us map by state 1970
#map coordinates of states
us_states <- usmap::us_map()

#abbreviation for state names
data_milk_cows = milk_cows |> mutate(
  state_abbr = state.abb[match(state, state.name)]
)

#merge location data with production data
combine_milk_cows_1970 <- us_states |>
 left_join(data_milk_cows, by = c("abbr" = "state_abbr")) |>
  filter (year == "1970") |>
  rename("Number of Cows" = number_of_cows)

ggplot(combine_milk_cows_1970) +
  geom_sf(aes(fill = `Number of Cows`), color = "white", size = 0.2) +
  #scale_fill_viridis_c(name = "number_of_cows",option = "plasma") +
  scale_fill_gradientn(
    #colors = c("pink", "magenta","orange","red"),  #magenta
    colors = c("lavender","magenta","darkmagenta","red2"), #"purple1"
    name = "Number of Cows"
  ) + 
  theme_minimal() +
  labs(title = "Milk Cows Distribution by State (per Thousand Head) (1970)") +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom"
  ) -> static_map_state_1970

ggplotly(static_map_state_1970)

```


```{r}
#table 2023 state
milk_cows |>
  filter(year == 2023) |>
  group_by(state,year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE)) |>
  arrange(desc(total_cows)) |>
  rename(State = state, 
         Year = year,
         "Total Cows 2023" = total_cows) |>
  head(5)  |>
  knitr::kable(caption = "Top 5 States in Total Cows (per Thousand Head) (2023)", format="html") |>
  kable_styling(full_width = TRUE, bootstrap_options = "bordered")

#line plot state 2023
milk_cows_state_2023 = milk_cows |>
  filter(year == 2023) |>
  group_by(state,year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE)) |>
  arrange(desc(total_cows)) |>
  rename(State = state, 
         "Total Cows 2023" = total_cows, 
         Year = year)


ggplot(milk_cows_state_2023, aes(x = reorder(State, `Total Cows 2023`), y = `Total Cows 2023`, color = State)) +
  geom_point(size=0.8) +  
  geom_line(group = 1, color = "lightblue") + 
  labs(
    title = "Total Number of Cows by State (per Thousand Head) (2023)",
    x = "State",
    y = "Total Cows",
    color = "State"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 80, hjust = 1)) -> static_line_state_2023

ggplotly(static_line_state_2023)

#us map state 2023
combine_milk_cows_2023 <- us_states |>
 left_join(data_milk_cows, by = c("abbr" = "state_abbr")) |>
  filter (year == "2023")

ggplot(combine_milk_cows_2023) +
  geom_sf(aes(fill = number_of_cows), color = "white", size = 0.2) +
  #scale_fill_viridis_c(name = "number_of_cows",option = "plasma") +
  scale_fill_gradientn(
    #colors = c("pink", "magenta","orange","red"),  #magenta
    colors = c("lavender","magenta","darkmagenta","red2"), #"purple1"
    name = "Number of Cows"
  ) + 
  theme_minimal() +
  labs(title = "Milk Cows Distribution by State (per Thousand Head) (2023)") +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
    #legend.position = "bottom"
  ) -> static_map_state_2023

ggplotly(static_map_state_2023)



```



## Trend of Total Cows by State 
```{r}
#line plot for milk cows over years across states - increasing and decreasing trend
custom_colors <- c(
  "#FF9999", "#FF6666", "#FF3333", "#FF0000", "#990000", "#660000", 
  "#99FF99", "#66CC66", "#33CC33", "#009900", "#006600", "#003300", 
  "#99CCFF", "#66CCFF", "#33CCFF", "#0099FF", "#0066FF", "#0033FF", 
  "#CCCCFF", "#9999FF", "#6666FF", "#3333FF", "#0000FF", "#000099", 
  "#FF99FF", "#FF66FF", "#FF33FF", "#FF00FF", "#9900FF", "#6600FF", 
  "#6600CC", "#660099", "#660066", "#6666CC", "#9999CC", "#99CC99", 
  "#FFCC99", "#FFCC66", "#FFCC33", "#FF9966", "#FF9966", "#FF6699", 
  "#FF3366", "#FF0033", "#FF0000", "#990033", "#660033", "#330033", 
  "#9933CC", "#6600CC", "#3300CC"
)

milk_cows_over_years = milk_cows |>
  group_by(state, year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop") |>  
  rename(State = state, 
         Year = year, 
         `Total Cows` = total_cows) |> 
  ggplot(aes(x = Year, y = `Total Cows`, color = State, group = State)) +  
  geom_point(size=0.8) +  
  geom_line() +    
  scale_color_manual(values = custom_colors) +  
  #scale_colour_discrete() + #don't like it
  labs(
    title = "Trend of Total Cows by State (1970-2023)",
    x = "Year",
    y = "Total Number of Cows",
    color = "State"
  ) +
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 85, hjust = 1)
  )

ggplotly(milk_cows_over_years)
```


```{r}
#increasing trend table
##total number of cows per state, year, and region
state_region_cows_summary <-milk_cows |>
  filter(year >= 1970 & year <= 2023) |>
  group_by(region, state, year) %>%
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop")

#year 1970
cows_1970 <- state_region_cows_summary |>
  filter(year == 1970) |>
  select(region, state, total_cows_1970 = total_cows)

#year2023
cows_2023 <- state_region_cows_summary |>
  filter(year == 2023) |>
  select(region, state, total_cows_2023 = total_cows)

#combine data
state_region_comparison <- left_join(cows_1970, cows_2023, by = c("region", "state")) |>
  mutate(percentage_increase = round(((total_cows_2023 - total_cows_1970) / total_cows_1970) * 100, 2)) |>
  filter(percentage_increase > 0) |>
  arrange(desc(percentage_increase)) |>
  rename(
    Region = region,
    State = state, 
    "Total Cows 1970" = total_cows_1970,
    "Total Cows 2023" = total_cows_2023, 
    "Percentage Increase" = percentage_increase
  )

#table
kable(state_region_comparison, caption = "States with Percentage Increase in Total Number of Cows (Per Thousand Head) (1970–2023)", format = "html") |>
  kable_styling(full_width = TRUE, bootstrap_options = "bordered") 

```

```{r}
#increasing trend plot
#custom colors
custom_colors = c("pink","red2","magenta2","magenta3","chartreuse3","salmon","maroon",
                  "mediumturquoise","purple1","burlywood3","orange","blue")

#increasing trend
milk_cows |>
  filter(state %in% c("New Mexico","Idaho","Arizona","Colorado","Nevada",
                      "California","Texas","Washington","Oregon","Utah","South Dakota","Michigan")) |>
  group_by(state, year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop") |> 
  rename(
    State = state,
    Year = year,
    `Total Cows` = total_cows
  ) |>
  ggplot(aes(x = Year, y = `Total Cows`, color = State, group = State)) +  
  geom_point(size=0.8) +  
  geom_line() +    
  scale_color_manual(values = custom_colors) +  
  #scale_color_viridis_d(option="plasma")
  labs(
    title = "Increasing Trend of Total Cows by State (1970-2023)",
    x = "Year",
    y = "Total Number of Cows (Thousands)",
    color = "State"
  ) +
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 80, hjust = 1)) -> state_increasing_trend
ggplotly(state_increasing_trend)

```



```{r}
#decreasing trend table
state_region_cows_summary <- milk_cows |>
  filter(year >= 1970 & year <= 2023) |>
  group_by(region, state, year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop")

#1970
cows_1970 <- state_region_cows_summary |>
  filter(year == 1970) |>
  select(region, state, total_cows_1970 = total_cows)

#2023
cows_2023 <- state_region_cows_summary |>
  filter(year == 2023) |>
  select(region, state, total_cows_2023 = total_cows)

#combine
state_region_comparison <- left_join(cows_1970, cows_2023, by = c("region", "state")) |>
  mutate(percentage_decrease = round(((total_cows_2023 - total_cows_1970) / total_cows_1970) * 100, 2)) |>
  filter(percentage_decrease < 0) |>
  arrange(percentage_decrease) |>
  rename(
    Region = region,
    State = state, 
    "Total Cows 1970" = total_cows_1970,
    "Total Cows 2023" = total_cows_2023, 
    "Percentage Decrease" = percentage_decrease
  )

#table
kable(state_region_comparison, caption = "States with Percentage Decrease in Total Number of Cows (Per Thousand Head) (1970–2023)", format = "html") |>
  kable_styling(full_width = TRUE, bootstrap_options = "bordered")

```


```{r}
#decreasing trend plot
#custom colors
custom_colors <- c(
  "#FF9999", "#FF6666", "#FF3333", "#FF0000", "#990000", "#660000", 
  "#99FF99", "#66CC66", "#33CC33", "#009900", "#006600", "#003300", 
  "#99CCFF", "#66CCFF", "#33CCFF", "#0099FF", "#0066FF", "#0033FF", 
  "#CCCCFF", "#9999FF", "#6666FF", "#3333FF", "#0000FF", "#000099", 
  "#FF99FF", "#FF66FF", "#FF33FF", "#FF00FF", "#9900FF", "#6600FF", 
  "#6600CC", "#660099", "#660066", "#6666CC", "turquoise", "#99CC99", 
  "#FFCC99", "#FFCC66", "#FFCC33", "#FF9966", "#FF9966", "#FF6699", 
  "#FF3366", "#FF0033", "#FF0000", "#990033", "#660033", "#330033", 
  "#9933CC", "#6600CC", "#3300CC"
)

#decreasing trend
milk_cows |>
  filter(state %in% c("Alabama", "Arkansas", "Mississippi", "Louisiana", "New Jersey",
                     "Rhode Island", "Tennessee", "North Dakota", "West Virginia",
                     "South Carolina", "Kentucky", "Massachusetts", "Missouri",
                     "Delaware", "North Carolina", "Montana", "Maryland", "Illinois", "Oklahoma",
                     "New Hampshire", "Connecticut", "Nebraska", "Virginia", "Maine",
                     "Minnesota", "Iowa", "Florida", "Wyoming", "Ohio", "Vermont", "Georgia",
                     "Pennsylvania", "New York", "Wisconsin", "Indiana", "Kansas")) |>
  group_by(state, year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop") |>  
  rename(
    Year = year, 
    State = state,
    `Total Cows` = total_cows
  ) |>
  ggplot(aes(x = Year, y = `Total Cows`, color = State, group = State)) +  
  geom_point(size=0.8) +  
  geom_line() +    
  scale_color_manual(values = custom_colors) +  
  #scale_color_viridis_d(option="plasma")
  labs(
    title = "Decreasing Trend of Total Cows by State (1970-2023)",
    x = "Year",
    y = "Total Number of Cows (Thousands)",
    color = "State"
  ) +
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 80, hjust = 1)
  ) -> state_decreasing_trend
ggplotly(state_decreasing_trend)

```

```{r}
combine_milk_cows = milk_cows |> 
group_by(region, state, year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop")

ggplot(combine_milk_cows) +
  geom_point(aes(x = reorder(state, total_cows), y = total_cows, color = total_cows), 
             alpha = 0.7) +  
  #scale_size_continuous(name = "number_of_cows", range = c(3, 7)) +
 # scale_color_viridis_c(name = "number_of_cows")  + 
  scale_color_gradientn(
    colors = c("pink", "magenta", "orange","red"),  #magenta
    name = "Number of Cows by State"
  ) +
  theme(axis.text.x = element_text(angle = 80, hjust = 1))+
  labs(title = "Number of Cows by State (1970-2023)", 
       x = "State",
       y = "Number of Cows")

```



## Milk Cows Statistics by Region

```{r}
#region 1970
combine_region_cows_1970 <- us_states |>
 left_join(data_milk_cows, by = c("abbr" = "state_abbr")) |>
  filter (year == "1970") |>
  group_by(region, year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop") |>
  rename(Region = region, 
         Year = year,
         `Total Cows` = total_cows)

#table 1970
milk_cows |> 
group_by(region, year) |>
filter(year == "1970") |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop") |>
  arrange(desc(total_cows)) |>
  select(region,total_cows) |>
  rename(Region = region, 
         "Total Cows 1970" = total_cows) |>
  knitr::kable(caption = "Total Number of Cows by Region (1970)", format = "html") |>
  kableExtra::kable_styling(full_width = TRUE, bootstrap_options = "bordered")

#line plot 1970
ggplot(combine_region_cows_1970, aes(x = reorder(Region, `Total Cows`), y = `Total Cows`, color = Region)) +
  geom_point(size=0.8) +  
  geom_line(group = 1, color = "gray") +  
  scale_color_manual(values = c("Northeast" = "blue", "Lake States" = "green", 
                               "Corn Belt" = "red", "Northern Plains" = "purple", 
                               "Appalachia" = "orange", "Southeast" = "pink",
                               "Delta States" = "yellow", "Southern Plains" = "cyan", 
                               "Mountain Region" = "brown", "West Coast" = "magenta")) +
  labs(
    title = "Total Number of Cows by Region (per Thousand Head) (1970)",
    x = "Region",
    y = "Total Cows",
    color = "Region"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 80, hjust = 1)) -> line_plot_region_2023
ggplotly(line_plot_region_2023)


#us map 1970
ggplot(combine_region_cows_1970) +
  geom_sf(aes(fill = `Total Cows`), color = "white", size = 0.2) +
  scale_fill_gradientn(
    #colors = c("pink", "magenta","orange","red"),  #magenta
    colors = c("lavender","magenta","darkmagenta","red2"), #"purple1"
    name = "Number of Cows"
  )+ 
  theme_minimal() +
  labs(title = "Milk Cows Distribution by Region (1970)") +
  theme(
    axis.text.x = element_text(angle = 80, hjust = 1),
    legend.position = "bottom"
  ) #-> us_plot_region_1970
#ggplotly(us_plot_region_1970)
```


```{r}
#region 2023
combine_region_cows_2023 <- us_states |>
 left_join(data_milk_cows, by = c("abbr" = "state_abbr")) |>
  filter (year == "2023") |>
  group_by(region, year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop") |>
  rename(Region = region, 
         Year = year,
         `Total Cows` = total_cows)


#table 
milk_cows |> 
group_by(region, year) |>
filter(year == "2023" ) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop") |>
  arrange(desc(total_cows)) |>
  select(region, total_cows) |>
  rename(Region = region, 
         "Total Cows 2023" = total_cows) |>
  knitr::kable(caption = "Total Number of Cows by Region (2023)", format = "html") |>
  kableExtra::kable_styling(full_width = TRUE, bootstrap_options = "bordered")
  

#line plot 
ggplot(combine_region_cows_2023, aes(x = reorder(Region, `Total Cows`), y = `Total Cows`, color = Region)) +
  geom_point(size=0.8) +  
  geom_line(group = 1, color = "gray") +  
  scale_color_manual(values = c("Northeast" = "blue", "Lake States" = "green", 
                               "Corn Belt" = "red", "Northern Plains" = "purple", 
                               "Appalachia" = "orange", "Southeast" = "pink",
                               "Delta States" = "yellow", "Southern Plains" = "cyan", 
                               "Mountain Region" = "brown", "West Coast" = "magenta")) +
  labs(
    title = "Total Number of Cows by Region (per Thousand Head) (1970)",
    x = "Region",
    y = "Total Cows",
    color = "Region"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 80, hjust = 1)) -> line_plot_region_2023
ggplotly(line_plot_region_2023)
  
#us map 2023
ggplot(combine_region_cows_2023) +
  geom_sf(aes(fill = `Total Cows`), color = "white", size = 0.2) +
  scale_fill_gradientn(
    #colors = c("pink", "magenta","orange","red"),  #magenta
    colors = c("lavender","magenta","darkmagenta","red2"), #"purple1"
    name = "Number of Cows"
  )+ 
  theme_minimal() +
  labs(title = "Milk Cows Distribution by Region (2023)") +
  theme(
    axis.text.x = element_text(angle = 80, hjust = 1),
    legend.position = "bottom"
  ) #-> us_plot_region_2023
#ggplotly(us_plot_region_2023)

```

## Trend of Total Cows by Region
```{r}
#line plot milk cows over years by region
milk_cows |>
  group_by(region, year) |>
  summarise(total_cows = sum(number_of_cows, na.rm = TRUE), .groups = "drop") |>  
  rename(
    Year = year, 
    Region = region,
    `Total Cows` = total_cows
  ) |>
  ggplot(aes(x = Year, y = `Total Cows` , color = Region, group = Region)) +  
  geom_point(size=0.8) +  
  geom_line() +    
  #scale_color_brewer(palette = "Set3") +  
  scale_color_manual(
    values = c("Appalachia" = "pink", 
               "Delta States" = "orange", 
               "Mountain Region" = "magenta2", 
               "Corn Belt" = "chartreuse3", 
               "Northern Plains" = "salmon", 
              "Southern Plains" = "maroon", 
              "Lake States" = "mediumturquoise",
              "Northeast" = "purple1",
              "Southeast" = "burlywood2",
                "West Coast" ="red2" )) + 
  labs(
    title = "Trend of Total Cows by Region (1970-2023)",
    x = "Year",
    y = "Total Number of Cows",
    color = "Region"
  ) +
  theme_minimal() + 
  theme(
    axis.text.x = element_text(angle = 80, hjust = 1),  
    legend.position = "bottom"
  ) -> trend_region
ggplotly(trend_region)
```

## Statistical Analysis by State
States like California, Minnesota, Wisconsin, and Michigan have much higher milk production compared to the baseline state Alabama. 

Overall Milk Production is significantly increased by year, with a general increase in production over time.

ANOVA test indicates a highly significant difference in number of cows across the different states.

```{r}

#lm model milk production by state
milk_cows |> 
  mutate(
    state = as.factor(state),  
    year = as.numeric(year)     
  ) |> 
  lm(number_of_cows ~ state + year, data = _) |>  
  broom::tidy() 


milk_cows |> 
  mutate(
    region = as.factor(state), 
    year = as.numeric(year)) |>
  aov(number_of_cows ~ state, data = _) |>  
  broom::tidy() |>
  knitr::kable()

```
## Statistical Analysis by Region

The  Corn Belt, Lake States, West Coast, and Southern Plains all show significantly higher milk production compared to the reference region Appalachia. 

The year has a significant positive effect on number of cows.

ANOVA test indicates a highly significant difference in number of milk cows across the different regions.

```{r}
#lm model milk production by region 
milk_cows |> 
  mutate(
    region = as.factor(region),  
    year = as.numeric(year)     
  ) |> 
  lm(number_of_cows ~ region + year, data = _) |>  
  broom::tidy() |>
  knitr::kable()


milk_cows |> 
  mutate(
    region = as.factor(region), 
    year = as.numeric(year)) |>
  aov(number_of_cows ~ region, data = _) |>  
  broom::tidy() |>
  knitr::kable()
```

