---
title: "Untitled"
author: "Tai Yue"
date: "2024-11-18"
output:
  html_document
  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```






```{r}


library(readxl)
library(dplyr)

file_path <- "fluidmilk.xlsx"
fluidmilk_data <- read_excel(file_path, sheet = "fluidmilk")


colnames(fluidmilk_data) <- c("Year", "Whole_Milk", "Reduced_Fat_2_%", 
                              "Low_Fat_1_%", "Skim", "Flavored_Whole", 
                              "Flavored_Other", "Buttermilk", "Eggnog", "Total_Sales")


fluidmilk_data <- fluidmilk_data %>%
  mutate(Year = as.numeric(Year)) %>%
  filter(!is.na(Year))


fluidmilk_data <- fluidmilk_data %>%
  mutate(across(Whole_Milk:Total_Sales, as.numeric))

print(fluidmilk_data)

key_stats <- fluidmilk_data %>%
  summarise(
    across(everything(), list(mean = mean, sd = sd, min = min, max = max), na.rm = TRUE)
  )


print(key_stats)

```


The dataset covers years from 1975 to 2023, with a mean year of around 1999. This indicates the dataset spans a considerable period, allowing for a long-term trend analysis.The mean value for "Whole Milk" sales is approximately 20,871.73 units. Based on the table, it appears that whole milk sales have generally decreased over time, as the earlier years show higher values than might be expected based on recent years. This might suggest a trend away from whole milk consumption over time.Similar trends might be visible in the data for "Reduced Fat 2%", "Low Fat 1%", and "Skim" milk types, which would be useful to confirm with visualizations.




## revised plot2
```{r}
library(plotly)
library(ggplot2)
library(dplyr)
library(tidyr)

colnames(fluidmilk_data) <- c("Year", "Whole_Milk", "Reduced_Fat_2_Percent", 
                              "Low_Fat_1_Percent", "Skim", "Flavored_Whole", 
                              "Flavored_Other", "Buttermilk", "Eggnog", "Total_Sales")


fluidmilk_data <- fluidmilk_data %>%
  mutate(Year = as.numeric(Year)) %>%  
  filter(!is.na(Year)) %>%             
  mutate(across(Whole_Milk:Total_Sales, as.numeric))  


fluidmilk_long <- fluidmilk_data %>%
  select(Year, Whole_Milk, Reduced_Fat_2_Percent, Low_Fat_1_Percent, Skim) %>%
  pivot_longer(cols = -Year, names_to = "Milk_Type", values_to = "Sales")

print(head(fluidmilk_long))
summary(fluidmilk_long)

if (any(is.na(fluidmilk_long$Sales))) {
  print("Warning: There are missing values in the Sales column.")
}

milk_colors <- c(
  "Whole_Milk" = "red", 
  "Reduced_Fat_2_Percent" = "orange", 
  "Low_Fat_1_Percent" = "magenta", 
  "Skim" = "pink"
)

ggplot_basic <- ggplot(fluidmilk_long, aes(x = Year, y = Sales, color = Milk_Type)) +
  geom_line(size = 1) +
  scale_color_manual(values = milk_colors) + 
  labs(title = "Trends in Different Milk Types Over Time", 
       x = "Year", 
       y = "Sales (Million Pounds)", 
       color = "Milk Type") +
  theme_minimal()

print(ggplot_basic)
ggplotly(ggplot_basic)

ggplotly(ggplot_basic)

ggplot_interactive <- ggplot(fluidmilk_long, aes(
  x = Year, 
  y = Sales, 
  color = Milk_Type, 
  text = paste0("Year: ", Year, 
                "<br>Milk Type: ", Milk_Type, 
                "<br>Sales: ", round(Sales, 2))
)) +
  geom_line(size = 1) +
  scale_color_manual(values = milk_colors) + 
  labs(title = "Trends in Different Milk Types Over Time", 
       x = "Year", 
       y = "Sales (Million Pounds)", 
       color = "Milk Type") +
  theme_minimal()


interactive_plot <- ggplotly(ggplot_interactive, tooltip = "text")

interactive_plot








```

Trends in Different Milk Types Over Time:

a.The sales of whole milk have experienced a dramatic decline since 1975. Initially the dominant milk type, it steadily decreased as consumers shifted toward lower-fat alternatives, reflecting changing dietary preferences and health trends.

b. Reduced-Fat (2%) Milk: gained popularity starting in the late 1970s and peaked around the 1990s. However, its sales began to decline after 2010, mirroring the overall decline in fluid milk consumption.

c. Skim milk experienced gradual growth from the 1980s to the early 2000s, reflecting increasing health- consciousness. However, its sales have significantly declined since the mid-2000s, suggesting a loss of favor among consumers, possibly due to taste or the rise of alternatives.

d.Sales of 1% milk have remained relatively stable over the years, though they have seen a slight decline post-2010.

While there was a clear shift from whole milk to reduced-fat and skim milk during the late 20th century, all categories have experienced declining sales since 2010. This underscores a broader trend of declining fluid milk consumption, possibly driven by the rise of plant-based alternatives, changing dietary habits, and demographic shifts.





## Flavored Whole Milk vs Flavored Non-Whole Milk Sales Over Time
```{r}

library(ggplot2)
library(dplyr)
library(tidyr)


fluidmilk_data_comparison <- fluidmilk_data %>%
  mutate(
    Flavored_Whole_Category = Flavored_Whole, 
    Flavored_Non_Whole_Category = Flavored_Other 
  ) %>%
  select(Year, Flavored_Whole_Category, Flavored_Non_Whole_Category) %>%
  pivot_longer(cols = c(Flavored_Whole_Category, Flavored_Non_Whole_Category),
               names_to = "Milk_Type", values_to = "Sales")


ggplot(fluidmilk_data_comparison, aes(x = Year, y = Sales, fill = Milk_Type)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Flavored Whole Milk vs Flavored Non-Whole Milk Sales Over Time",
    x = "Year",
    y = "Sales (Million Pounds)",
    fill = "Milk Type"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```
Flavored non-whole milk consistently outpaces flavored whole milk in sales, especially after the 1990s.Both categories show significant growth from the 1980s, peaking around the late 1990s to early 2000s. Sales for both categories decline sharply after 2010, aligning with broader trends of reduced fluid milk consumption.Flavored whole milk exhibits relatively stable sales compared to the larger fluctuations seen in flavored non-whole milk.





##Line Plot: Trends in Total Milk Sales Over Time
```{r}

library(ggplot2)


ggplot(fluidmilk_data, aes(x = Year, y = Total_Sales)) +
  geom_line(color = "blue", size = 1) +
  scale_y_continuous(limits = c(25000, NA)) +  
  labs(
    title = "Total Fluid Milk Sales Over Time",
    x = "Year",
    y = "Total Sales (Million Pounds)"
  ) +
  theme_minimal()

```
a.Growth Period (1975 to mid-1980s): During this period, total fluid milk sales experienced steady growth, likely driven by population growth and increased demand for dairy products.

b.Plateau Phase (mid-1980s to around 2010): Sales remained relatively stable, indicating a period of sus- tained consumption where demand neither increased nor decreased significantly.

c.Decline Period (2010 to 2023): After 2010, a sharp and continuous decline in fluid milk sales is observed, reflecting a significant shift in consumer preferences and market trends.

the data suggests a major transformation in the dairy industry, particularly in the last decade, as consumer behaviors evolve. Understanding the underlying factors driving these trends would be key for stakeholders in the dairy market to adapt to these changes.

## mean sales over decades
```{r}
library(ggplot2)
library(dplyr)


fluidmilk_data <- fluidmilk_data %>%
  mutate(Decade = floor(Year / 10) * 10)  


mean_sales_by_decade <- fluidmilk_data %>%
  group_by(Decade) %>%
  summarise(Mean_Sales = mean(Total_Sales, na.rm = TRUE))  


ggplot(mean_sales_by_decade, aes(x = as.factor(Decade), y = Mean_Sales)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Mean Fluid Milk Sales by Decade",
    x = "Decade",
    y = "Mean Sales (Million Pounds)"
  ) +
  theme_minimal()
```

This histogram shows the mean fluid milk sales by decade. Sales remained relatively stable from the 1970s to the 2000s, hovering around similar levels. A noticeable decline begins in the 2010s and continues into the 2020s, reflecting shifting consumer preferences and reduced demand for fluid milk. This trend highlights a major change in the milk market over the past two decades.
