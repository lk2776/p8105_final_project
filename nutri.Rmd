---
title: "Nutrition"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
library(gridExtra)
```


```{R}
df <- readxl::read_xlsx('nutri.xlsx')|>
  head(11)
nutri <- df |>
  as.data.frame() |>
  mutate(Whole = as.double(Whole))
nutri_d <- nutri |>
  mutate(mean_diff = rowMeans(across(c(Whole, `2 Percent`, `1 Percent`))) -Skim) |>
  select(c(1,6)) |>
  filter(mean_diff != 0)
print(nutri_d)
```

We calculated the mean of the nutritional components for whole, 2% and 1% milk and subtracted the corresponding component for skim milk. If this mean difference is not 0 it means that there is some difference across the milk types for that component. 


```{R}
extra = c (0,0,0,0)
selected_rows <- nutri[c(1, 3, 5, 11), ]
nutri_bp = cbind(selected_rows, extra)
rows_to_plot <- c(1, 2, 3, 4)
legend_labels <- names(nutri_bp)[2:(ncol(nutri_bp) - 1)]

# Loop
for (i in rows_to_plot) {
  values <- as.numeric(nutri_bp[i, 2:ncol(nutri_bp)])
  plot_title <- nutri_bp[i, 1]
  bc = c("red","orange","magenta","pink","transparent")
  bar_pos <- barplot(values, main = plot_title, col = bc, border = NA) 
  for (j in seq_along(values)) { if (values[j] != 0) { 
    rect(bar_pos[j] - 0.5, 0, bar_pos[j] + 0.5, values[j], border = "black") } 
    } 
  legend("topright", legend = legend_labels, fill = bc[-length(bc)], title = "Milk Type", cex = 0.8)
}
```

There is a decreasing trend as we go towards the lower fat options for calories and cholesterol.
Quantity of sodium is roughly the same for all 4 (higher in 1% and skim).
Skim has the least amount of calcium. The rest seem to have the same amount.


```{R}
# Making a layout
layout(matrix(c(1, 1, 2, 3, 4, 5), nrow=3, ncol=2, byrow=TRUE), heights=c(0.2, 1, 1))
par(mar=c(0, 0, 2, 0)) # Adjust margins for the title
plot.new()
title(main="Cholesterol Intake /cup for a 2000 calorie diet", cex.main=2, font.main=2)
percentages <- c(12, 6, 5, 2)
titles <- c("Whole Milk", "2% Milk", "1% Milk", "Skim Milk")
colors <- c("coral", "white")

par(mar=c(4, 4, 2, 2)) # Adjusting margins

#Pie charts
for (i in 1:4) { pie(c(percentages[i], 100 - percentages[i]), labels = c("", ""), col = colors, main = titles[i], cex = 1.5)}
```

The above pie charts show the cholesterol intake per cup for a 2000 calorie diet. Obviously, higher fat means more cholesterol. This intake is quite important as a health conscious person is likely to lean towards the lower fat options because of the lower cholesterol. Accompany the individual cholesterol with the fact that most people will use milk in some way and not just drink it straight up implies that the way they consume it (through cereal or drinks) would increase their cholesterol intake due to what they added.

```{R}

data1 <- data.frame(
  Variable = factor(titles, levels = titles),  
  Percentage = c(10, 6, 3, 0)
)

data2 <- data.frame(
  Variable = factor(titles, levels = titles),  
  Percentage = c(25, 15, 7, 0)
)

colors <- c("Whole Milk" = "red", "2% Milk" = "orange", "1% Milk" = "magenta", "Skim Milk" = "pink")

plot1 <- ggplot(data1, aes(x = Variable, y = Percentage, fill = Variable)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = colors) +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 28, by = 4)) +
  theme_minimal() +
  labs(title = "Total Fat", x = "", y = "% of Daily Value for 2000 Cal. Diet") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none")

plot2 <- ggplot(data2, aes(x = Variable, y = Percentage, fill = Variable)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = colors) +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 28, by = 4)) +
  theme_minimal() +
  labs(title = "Saturated Fat", x = "", y = "") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none")

get_legend <- function(myplot) {
  tmp <- ggplot_gtable(ggplot_build(myplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}

legend <- get_legend(ggplot(data1, aes(x = Variable, y = Percentage, fill = Variable)) +
                       geom_bar(stat = "identity") +
                       scale_fill_manual(values = colors) +
                       theme_minimal() +
                       labs(fill = "Milk Type"))

grid.arrange(plot1, plot2, legend, ncol = 3, widths = c(2.5, 2.5, 1))



```