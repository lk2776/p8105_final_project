---
title: "Nutrition Analysis"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(gridExtra)
library(knitr)
library(kableExtra)
```

<br>

```{R, echo= FALSE}
df <- readxl::read_xlsx('nutri.xlsx')|>
  head(11)
nutri <- df |>
  as.data.frame() |>
  mutate(Whole = as.double(Whole))
nutri_d <- nutri |>
  mutate(mean_diff = rowMeans(across(c(Whole, `2 Percent`, `1 Percent`))) -Skim) |>
  select(c(1,6)) |>
  filter(mean_diff != 0)
colnames(nutri_d)[2] <- "Mean Difference"
nutri_same <- nutri |>
  mutate(mean_diff = rowMeans(across(c(Whole, `2 Percent`, `1 Percent`))) -Skim) |>
  filter(mean_diff == 0) |>
  select(1,3)
colnames(nutri_same)[2] <- "All 4 Milk Types"
kable(nutri_same, format = "html") |>
  kable_styling(bootstrap_options = "striped", full_width = TRUE) |>
  add_header_above(c("Nutritional Components Same Across Milk Types" = ncol(nutri_same)), 
                   bold = TRUE, align = "c", background = "pink") |>
  row_spec(0, bold = TRUE)

```

The above table provides us with nutritional components that are the same for all 4 types of milk.

To analyze differences in milk types, we will subtract the values for skim milk from the mean of the other milk types. If the result is not zero, it indicates a difference. Since skim milk has the least fat, it and whole milk will have extreme values, meaning the mean of the others won't match skim milk.

```{R, echo = FALSE}
kable(nutri_d, format = "html") |>
  kable_styling(full_width = TRUE, bootstrap_options = "bordered") |>
  add_header_above(c("Nutritional Components Different Across Milk Types" = ncol(nutri_d)), 
                   bold = TRUE, align = "c", background = "pink") |>
  row_spec(0, bold = TRUE)
```

While the table identifies which components differ, it only indicates where to analyze further. Visualizing these differences with bar plots will provide more insightful and intuitive comparisons.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
extra <- c(0, 0, 0, 0)
selected_rows <- nutri[c(1, 3, 5, 11), ]
nutri_bp <- cbind(selected_rows, extra)
rows_to_plot <- c(1, 2, 3, 4)
legend_labels <- names(nutri_bp)[2:(ncol(nutri_bp) - 1)]
bc <- c("red", "orange", "magenta", "pink", "transparent")

for (i in rows_to_plot) {
  values <- as.numeric(nutri_bp[i, 2:ncol(nutri_bp)])
  plot_title <- as.character(nutri_bp[i, 1])
  png(filename = paste0("plot_", i, ".png"), width = 800, height = 600, res = 150)
  bar_pos <- barplot(values, main = plot_title, col = bc, border = NA, cex.main = 0.9)
  for (j in seq_along(values)) { 
    if (values[j] != 0) { 
      rect(bar_pos[j] - 0.5, 0, bar_pos[j] + 0.5, values[j], border = "black")
    }
  }
  legend("topright", legend = legend_labels, fill = bc[-length(bc)], title = "Milk Type", cex = 0.65)
  dev.off()
}

```

```{r, results='asis', echo=FALSE}
htmltools::HTML('
<div class="slideshow-container">

    <div class="slides">
        <img src="plot_1.png" style="width:100%">
    </div>

    <div class="slides">
        <img src="plot_2.png" style="width:100%">
    </div>

    <div class="slides">
        <img src="plot_3.png" style="width:100%">
    </div>

    <div class="slides">
        <img src="plot_4.png" style="width:100%">
    </div>

    <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
    <a class="next" onclick="plusSlides(1)">&#10095;</a>
</div>

<style>
    .slideshow-container {
        max-width: 100%;
        position: relative;
        margin: auto;
    }
    .slides {
        display: none;
    }
    .prev, .next {
        cursor: pointer;
        position: absolute;
        top: 50%;
        width: auto;
        padding: 16px;
        color: white;
        font-weight: bold;
        font-size: 48px; /* Increased font size */
        transition: 0.6s ease;
        border-radius: 0 3px 3px 0;
        user-select: none;
        transform: translateY(-50%);
        z-index: 2; /* Ensure arrows are on top of other elements */
        background-color: rgba(0,0,0,0.5); /* Adding background for better visibility */
    }
    .next {
        right: 10px; /* Adjusted to prevent overlap with edge */
        border-radius: 3px 0 0 3px;
    }
    .prev {
        left: 10px; /* Adjusted to prevent overlap with edge */
        border-radius: 3px 0 0 3px;
    }
    .prev:hover, .next:hover {
        background-color: rgba(0,0,0,0.8);
    }
</style>

<script>
let slideIndex = 1;
showSlides(slideIndex);

function plusSlides(n) {
    showSlides(slideIndex += n);
}

function showSlides(n) {
    let i;
    let slides = document.getElementsByClassName("slides");
    if (n > slides.length) {slideIndex = 1}
    if (n < 1) {slideIndex = slides.length}
    for (i = 0; i < slides.length; i++) {
        slides[i].style.display = "none";
    }
    slides[slideIndex-1].style.display = "block";
}
</script>
')


```

There is a decreasing trend as we go towards the lower fat options for calories and cholesterol.
Quantity of sodium is roughly the same for all 4 (higher in 1% and skim).
Skim has the least amount of calcium. The rest seem to have the same amount.


```{R, echo= FALSE}
# Making a layout
layout(matrix(c(1, 1, 2, 3, 4, 5), nrow=3, ncol=2, byrow=TRUE), heights=c(0.2, 1, 1))
par(mar=c(0, 0, 2, 0)) # Adjust margins for the title
plot.new()
title(main="Cholesterol Intake /cup for a 2000 calorie diet", cex.main=2, font.main=2)
percentages <- c(12, 6, 5, 2)
titles <- c("Whole Milk", "2% Milk", "1% Milk", "Skim Milk")
colors <- c("coral", "lightyellow")

par(mar=c(4, 4, 2, 2)) # Adjusting margins

#Pie charts
for (i in 1:4) { pie(c(percentages[i], 100 - percentages[i]), labels = c("", ""), col = colors, main = titles[i], cex = 1.5)}
```

The above pie charts show the cholesterol intake per cup for a 2000 calorie diet. Obviously, higher fat means more cholesterol. This intake is quite important as a health conscious person is likely to lean towards the lower fat options because of the lower cholesterol. Accompany the individual cholesterol with the fact that most people will use milk in some way and not just drink it straight up implies that the way they consume it (through cereal or drinks) would increase their cholesterol intake due to what they added.

<br>

```{R, echo= FALSE}
data1 <- data.frame(
  Variable = factor(titles, levels = titles),  
  Percentage = c(10, 6, 3, 0)
)

data2 <- data.frame(
  Variable = factor(titles, levels = titles),  
  Percentage = c(25, 15, 7, 0)
)

colors <- c("Whole Milk" = "red", "2% Milk" = "orange", "1% Milk" = "magenta", "Skim Milk" = "pink")

empty_plot <- ggplot() + theme_void()

plot1 <- ggplot(data1, aes(x = Variable, y = Percentage, fill = Variable)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = colors) +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 28, by = 4)) +
  theme_minimal() +
  labs(title = "Total Fat", x = "", y = "% of Daily Value for 2000 Cal. Diet") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none")

plot2 <- ggplot(data2, aes(x = Variable, y = Percentage, fill = Variable)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = colors) +
  scale_y_continuous(limits = c(0, 30), breaks = seq(0, 28, by = 4)) +
  theme_minimal() +
  labs(title = "Saturated Fat", x = "", y = "") +
  theme(plot.title = element_text(hjust = 0.5), legend.position = "none")

get_legend <- function(myplot) {
  tmp <- ggplot_gtable(ggplot_build(myplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)
}

legend <- get_legend(ggplot(data1, aes(x = Variable, y = Percentage, fill = Variable)) +
                       geom_bar(stat = "identity") +
                       scale_fill_manual(values = colors) +
                       theme_minimal() +
                       labs(fill = "Milk Type"))
grid.arrange(empty_plot, plot1, plot2, legend, ncol = 4, widths = c(1, 2, 2, 1.5))
```

The fat content decreases progressively from Whole Milk to 2% Milk, 1% Milk, and Skim Milk, reflecting their names. The bar plots above effectively illustrate this reduction. For instance, a 1% decrease indicates that our total and saturated fat intake is halved when transitioning from Whole to 2% Milk, and further reduced from 2% to 1%, ultimately reaching zero in Skim Milk.